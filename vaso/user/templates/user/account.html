{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"/>
    <link rel="stylesheet" href="{% static 'main/css/normalize.css' %}">
    <link rel="stylesheet" href="{% static 'main/css/fonts.css' %}">
    <link rel="stylesheet" href="{% static 'main/css/main.css' %}">
    <link rel="stylesheet" href="{% static 'user/css/user.css' %}">
    <title>{{title}}</title>
</head>
<body>
    <body id="workspce">
        <div class="w-100">
            <div class="toolbar-workspace">
                <div class="container-workspace  h-100 px-5">
                    <div class="toolbar-workspace-container h-100">
                        <a href="{% url 'main' %}" class="back-btn-workspace">
                        </a>
                        <div class="main-logo-sm-sm"></div>
                    </div>
                </div>
            </div>
            <div class="container-workspace">
                <div class="row mt-5 pt-lg-5 px-5">
                    <div class="col-lg-4 col-12">
                        <div class="d-flex flex-column h-100">
                            <div class="row justify-content-between justify-content-md-start">
                                <div class="col-auto">
                                    <i class="user-icon"></i>
                                </div>
                                <div class="col-10">
                                    <span class="user-name-workspace limit-word-two-line">{{ user.name }}</span>
                                </div>
        
                                <div class="d-flex align-items-center">
                                    <span class="light-text-workspace limit-word">
                                        {{ user.phone_number }}
                                    </span>
                                </div>
                            </div>
        
        
                            <div class="d-flex justify-content-lg-start justify-content-center pt-5">
                                <div class="client-card-workspace">
                                    <div class="row justify-content-between position-relative">
                                    <span class="client-card-workspace-text">
                                        Карта клиента
                                    </span>
                                        <i class="info-icon-workspace pointer"></i>
                                    </div>
                                    <div class="row">
                                        <span class="client-card-workspace-text-bold">Скидка 10%</span>
                                    </div>
                                </div>
                            </div>
        
                            <div class="support-workspace d-lg-block d-none">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        <i class="support-icon"></i>
                                    </div>
                                    <div class="col-auto">
                                        <div class="row"><span class="support-md-text-workspace">Нужна помощь?</span></div>
                                        <div class="row mt-2">
                                            <span class="support-lg-normal-text-workspace">Служба поддержки 24/7</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-4">
                                    <span class="support-md-md-text-workspace">+7 928 816 74 47</span>
                                </div>
                            </div>
                            <div class="mt-auto pb-5 d-lg-block d-none">
                                <a href="{% url 'logout' %}" class="row pointer" role="button">
                                    <div class="col-auto"><span class="support-workspace-text d-block">Выйти из профиля</span>
                                    </div>
                                    <div class="col-auto"><button class="logout-icon"></button></div>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8 col-12 mt-5 mt-md-0">
                        <div class="row justify-content-center">
                            <h2 class="title-text-workspace">Мои заказы</h2>
                        </div>
                        {% if active_orders %}
                        <div class="row justify-content-center justify-content-lg-start mt-5 pb-5">
                            {% for active_order in active_orders %}
                            <div class="status-card-workspace">
                                <div class="row justify-content-center">
                                    <div class="col-md-auto col-12">
                                        <div class="d-flex justify-content-center justify-content-lg-center">
                                            <div class="order-img" style="background-image: url(
                                            {% if active_order.bouquet.images %}{{ active_order.bouquet.images.url }}
                                            {% else %}{% static 'default_images/default_bouquet.png' %}{% endif %})">
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-center no-gutters mt-3">
                                            {% if active_order.status == display_payment_button_status %}
                                            <a href="{{ active_order.payment.url }}" class="btn btn-secondary btn-pay-order-card-workspace" role="button">
                                                <span class="d-block mt-1 text-black">Оплатить заказ</span>
                                            </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-12">
                                        <div class="row justify-content-center mt-5 mt-md-0">
                                <span class="status-card-text-title-workspace text-center d-block w-100">
                                     Статус заказа: {{ active_order.status.value }}
                                 </span>
                                        </div>
                                        {% if active_order.status == display_courier_status %}
                                        <div class="row justify-content-center mt-5 px-3">
                                            <span class="status-card-text-main-workspace text-center">Курьер: {{ active_order.courier }}</span>
                                        </div>
                                        {% endif %}
                                        <div class="row justify-content-center mt-4 px-3">
                                            <span class="status-card-text-main-workspace text-center">Адрес доставки:</span>
                                            <span class="status-card-text-main-workspace text-center limit-word-two-line">{{ active_order.address }}</span>
                                        </div>
        
                                        <div class="row justify-content-center mt-4 px-3">
                                            <span class="status-card-text-main-workspace text-center">
                                                Дата и время доставки: {{ active_order.expected_delivery_time|date:"d.m.Y H:i" }}
                                            </span>
        
                                        </div>
        
                                        <div class="row justify-content-center mt-5">
                                <span class="status-card-text-title-workspace text-center d-block w-100">
                                     Сумма заказа: {{ active_order.amount }}
                                 </span>
                                        </div>
        
                                        <div class="row justify-content-center no-gutters mt-3">
                                            <button type="submit" class="btn-chat-status-card-workspace">
                                                <span class="text-white">Чат с флористом</span>
                                            </button>
                                        </div>
                                        {% if active_order.status in cancellable_statuses %}
                                        <form method="post" action="{% url 'cancel-order' active_order.id %}">
                                            {% csrf_token %}
                                            <div class="row justify-content-center no-gutters mt-3">
                                                <button type="submit" class="btn-cancellations-card-workspace">
                                                    <span class="">Отмена заказа</span>
                                                </button>
                                            </div>
                                        </form>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
        
                            <div class="row order-line-workspace justify-content-center justify-content-lg-start align-items-center mt-5">
                                <!-- История заказов -->
                                {% for previous_order in previous_orders %}
                                <div class="col-lg-auto col-md-auto col-12">
                                    <div class="d-flex justify-content-center">
                                        <div class="order-img" style="background-image: url(
                                        {% if previous_order.bouquet.images %}{{ previous_order.bouquet.images.url }}
                                        {% else %}{% static 'default_images/default_bouquet.png' %}{% endif %})">
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-center">
                                        <span class="status-card-text-main-workspace text-center mt-2">
                                           {{ previous_order.expected_delivery_time|date:"d.m.Y"}}
                                        </span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% else %}
                        <div class="row justify-content-center mt-5 pb-5">
                            <div class="status-card-workspace">
                                <h3 class="status-card-text-title-workspace">Заказов пока нет</h3>
                            </div>
                        </div>
                        {% endif %}
                        <div class="support-workspace d-block d-lg-none">
                            <div class="divider-line mb-5"></div>
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <i class="support-icon"></i>
                                </div>
                                <div class="col-auto">
                                    <div class="row"><span class="support-md-text-workspace">Нужна помощь?</span></div>
                                    <div class="row mt-2">
                                        <span class="support-lg-normal-text-workspace">Служба поддержки 24/7</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <span class="support-md-md-text-workspace">+7 928 816 74 47</span>
                            </div>
                        </div>
                        <div class="mt-auto pb-5 d-block d-lg-none">
                            <div class="divider-line mb-5"></div>
                            <a href="{% url 'logout' %}" class="row justify-content-between" role="button">
                                <div class="col-auto"><span class="support-workspace-text d-block">Выйти из профиля</span>
                                </div>
                                <div class="col-auto"><button class="logout-icon" type="submit"></button></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
        </div>
</body>
</html>